INDEX DLG
---------
(wrapper to IndexDlg)
separate object for each dispatcher)
OpIndex, OpGeneric, OpMenu, OpGlobal
sidebar separate object

global -- version, screen width, height
mutt-level vars, (read-only)
account, no password
folder, full path, canonical
index info: size, current pos, last update, dirty
email: fold level, parent, num children, siblings
email headers: is-body-cached?
flags, attachments (if known), pgp signature
function fails, default to mutt's normal view
To, From, etc lists
Address: is_alias?
State preserved between calls
Pre/Post index lua call?
Option to hide (limit) the email

Add new expandos, %L1, %L2, etc to be filled by the script.
fixed expandos, e.g. %+L3, or let lua do it?
	fixed => coordination needed between config and lua
need patterns to search/limit for/by them
sorting by L-field?

how to colour the output?
how to format the fields?

Index.*nav*.page_down()

index.function() no params needed, BUT
could take (NUM) as a repeat count

## Index

A one-pass processing of the mailbox.
Call the script once for each email.

**Pass in:**
- Copy of all the fields
- Current account
- Current mailbox
- Current email

**Define functions to:**
- Colour:
  * All of the line
  * One field
  * Regex on field, or line
- Modify a field (‡)
- Hide / Delete an email (‡)
- Set the fold level of thread
- Set score of email
- Lookup address -- is_alias()
- Add/remove icon for email
  * Flag GitHub notifications
  * Add coloured stars

Can optionally disable Mutt's colouring

lua-index
	allow it to fold/unfold thread
	count/score children
	set fields

lua-index-colour
	if it returns TRUE, don't use Mutt's colours

lua-index-icon
	use case: github
	gh sends notification emails
	cc: field is coded, e.g.  state-change@gh.com
	turn that into a coloured icon

lua-forall-index
	iterate through every mail
	order by:
		index sorting?
		variable?
		ask script?
	Options:
		shallow (thread head only)
		width-first
		depth-first
		max-depth
		sort order

lua-index needs both label and notmuch callbacks

index_helper - perform actions on:
	Mailbox(View), Thread, Email(View)
	Menu/navigation

can't change dialogs, because it's single-threaded
*could* change Mailboxes as long as we remain in the Index

have an Index object representing the IndexDialog, etc
	it can perform <function>s
		which return enum FunctionRetval
	it can give out state info

colour-code authors by rule:
	pattern (already possible)
	in "aliases" (_might_ be possible)
	custom colour from alias @tags
		HOW: they're simple keys, not key=values
	from alias comments?

replace address fields with "tidy" version from Aliases
	or alias short-name
	need "display address" cf "display subject"

