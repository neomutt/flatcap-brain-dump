lua includes deprecated commands
	sidebar_whitelist
	unsidebar_whitelist

sleep command (allow fractions of seconds)

alter package path in NeoMutt to include /usr/share/neomutt/lua
	for shared scripts

need helper code for each dialog
	index_helper knows about Mailbox/Emails etc

state persists between scriptsQUAD_ASKYES
(config lua_persist=yes?)
`:lua-reset` to clear state

*could* queue up changes
Index
	<enter-command>lua-source apple.lua<enter>
apple.lua
	find email
	alter email headers
	push <display-message>
	push banana.lua
	[end]
NeoMutt
	queue: open Pager
	queue: run banana.lua
	[queue empty]
banana.lua
	<skip-headers>
	[end]

use inheritance from Mailbox to
	ImapMailbox
	MaildirMailbox
	etc
Same for all Object + ObjectData

cycler script - cycle between a set of values
	cycler("sidebar_width", 30, 60, 90)
	if value is in list, pick next value (cycling round)
	if value is not in list, pick first value

global
	add sleep() function (float val)
	add enter_string()
	add multi_choice()
	add yes_or_no()

lua-reset -- reset entire state

Top-level objects: neomutt, config, index (1 per dlg)
Do we need an umbrella object?  neo.x, .y, .z?
Does it matter?  scripts are "captive" to NeoMutt

contrib scripts need:
	name, author(s), license, homepage, description

should dlgs offer fns by OpX?
OpMenu obj? or just one big set of fns?

Info page - show loaded scripts. :lua?
"window-hook index lua-source..." HOW?

NEOMUTT
-------
(root of DOM)
account
mailbox
email
address
navigation between
some directions not possible

DLGS/WINDOWS?
-------------
(wrapper to Windows)
get_current() -> IndexDlg *object*
each obj has base class
name, focused/active
(might not be active if stacked)
enumerate? -> breadcrumbs
bindings[], functions[]
name(), enum *fns*, fn groups
many dlgs are -> SimplePagerWin

COLOURS
-------
(wrapper to theming)
get/set/+=/-=/(color or attrs)
enumerate objs/lists
uncolor, unattr (mono?)

ALIASES
-------
(wrapper to aliases)
enumerate, search
alias obj[]

SIDEBAR (window)
-------
wrapper to sidebar (mailbox)
enum Mailboxes
get/set format
custom colours
custom sorting
custom display string
width => wrapper to cfg, etc

----------------------------------------

lua interaction with neo prompts: HOW?
text entry, multi-choice, y/n, etc
pass response table to Neo?
Neo prompts need unique ids

∀ objects properties()
	=> table of class members that can be accessed
	with get_X() -> read only

Error handling
--------------

retval 0 success, n error
errors will differ depending on operation
could generate msg as source and return (error code, msg)
or return just error code ahd ahve perror() fn to generate msg


Alter MenuFuncOp, OP_LUA_ALLOWED => save to run *live*
	anything else would need to be queued and lua return first

∀ object: get_functions() -> table of approved fns
if user does <change-folder> from script,
use lua_error() as a cutout - it kills the script,
we log the termination

lua-source: predefined path
or $lua_source_path (or $lua_path?)
at lua startup / reset prepend path to [package.path]
default to ".:~/.config/neomutt/lua:/usr/share/neomutt/lua"
	cf mailcap_path
DT_STARTUP_ONLY

symlink both dirs to ~/lua for convenience
startup only *unless* we preserve orig [package.path]

lua-mode: run lua cmds without "lua" prefix
until "exit" or Ctrl-D.  needs dedicated history!
put :lua X into HIST_LUA *too*
lua-mode show lua console

userdata_get_type -> "Index" or define consts

Email: is_message_cached() -> quick access

email need thread navigation info:
	has children
	has parent
	has siblings / next/prev

∀ object define __tostring(), inc memaddr ifdef DEBUG
fake <limit> string "[lua]" for hiding

Mailbox methods to get sets of Emails:
	get_pattern("~s xyz")
	get_range(a|NULL, b|NULL)
		NULL -> end of range
		NULL,NULL => all
	get_thread(email|NULL)

some overlap with Email get_fns
∀ objs get_type()s enum/string
move console to right, out of all-dialogs, full height
add fns up/down, search?

:source supports relative paths, but :lua-source doesn't!
	when called from hooks

lua callback ∀ notifications

add lua test to release
	neomutt -B -F contrib/lua/test_lua-api_runner.neomuttrc

alt-e resend_message - which hooks are called?
	add lua hook

struct PatternFlags Flags
need space for lua-custom fields => multi-char patterns? HOW?

install contrib script
	add package path

look for neomutt.lua or neomutt/init.lua
	*before* neomuttrc

call lua_gc(l, LUA_GCCOLLECT);
	after :lua :lua-source ?

allow scripts to show/hide the console?
	auto-display on logging?  NO
allow scripts to clear the console?
	sounds nefarious

Add fake headers to Email in Pager
	cf NotMuch
	e.g. GitHub metadata

as scripts develop we might need a lua-if-def for feature support
	or check that VERSION > YYYY-MM-DD
	can check if OBJECT.FUNCTION exists

process security headers, e.g. DKIM, Virus scanning, etc into icons

create new discussion for just lua

post [linear] does lua need the gui at all?
	neomutt --lua script
	open/navigate mailboxes
	perform tasks
	log results

create lua feature page
	temp until lua.neomutt.org

expando: have demo script insert the %L1 it needs before %s
	if %s is formatted it might be hard to find
	if config.index_format returns a ConfigExpando,
	it could be navigated/manipulated
	allowing all sorts of dynamic Menu redesign
		e.g. auto-fit columns

expando: create %{lua-custom-1}, etc or just %{lua-1}?

